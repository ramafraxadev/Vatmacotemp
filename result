import { mount } from '@vue/test-utils'
import { describe, it, expect, beforeEach } from 'vitest'
import mckitui from 'mc-kit-ui/src/plugins/mc-kit-ui'
import DocumentDasboardExportList from '../DocumentDasboardExportList.vue'

describe('DocumentDasboardExportList.vue', () => {
  let wrapper

  beforeEach(() => {
    wrapper = mount(DocumentDasboardExportList, {
      props: {
        documentDasboardExportListTotal: 7,
      },
      global: {
        plugins: [mckitui],
        stubs: {
          'mc-card': { template: '<div><slot /></div>' },
          'mc-title-heading': { props: ['headingText'], template: '<h3>{{ headingText }}</h3>' },
          'mc-link': { props: ['linkText', 'linkHref'], template: '<a :href="linkHref">{{ linkText }}</a>' },
        },
      },
      slots: {
        default: '<div class="slot-content">Slot test</div>',
      },
    })
  })

  it('affiche le titre avec le nombre total d’exports', () => {
    const heading = wrapper.find('h3')
    expect(heading.exists()).toBe(true)
    expect(heading.text()).toContain('7 exports')
  })

  it('contient la description et les liens d’aide', () => {
    const description = wrapper.find('.documents_dashboard_export_list_card_titre_description')
    expect(description.exists()).toBe(true)

    const links = wrapper.findAll('a')
    expect(links.length).toBe(3)
    expect(links[0].attributes('href')).toContain('help.macompta.fr')
  })

  it('rend le contenu du slot', () => {
    const slot = wrapper.find('.slot-content')
    expect(slot.exists()).toBe(true)
    expect(slot.text()).toBe('Slot test')
  })
})
